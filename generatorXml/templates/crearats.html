{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Xml</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<style>
    .password-wrapper {
        position: relative;
    }

    @keyframes fade {
        0% {
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
    }

    /* Aplicar la animación al elemento */
    .fade {
        animation: fade 1s ease-in-out;
    }

    .toggle-password {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        cursor: pointer;
        display: flex;
        align-items: center;
    }
    .loader-container {
        display: grid;
        place-items: center;
    }
    #containerLoaderEmit{
        display: grid;
        place-items: center;
    }
    /* HTML: <div class="loader"></div> */
.loader {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
  border: 4px solid #0000;
  border-radius: 50%;
  border-right-color: #ED1C24;
  animation: l15 1s infinite linear;
}
.loader::before,
.loader::after {    
  content: "";
  grid-area: 1/1;
  margin: 2px;
  border: inherit;
  border-radius: 50%;
  animation: l15 2s infinite;
}
.loader::after {
  margin: 8px;
  animation-duration: 3s;
}
@keyframes l15{ 
  100%{transform: rotate(1turn)}
}

/* HTML: <div class="loader"></div> */
#loaderDownload {
  margin-top: 20px;
  width: 90px;
  height: 14px;
  box-shadow: 0 3px 0 #212121;
  position: relative;
  display: grid;
  clip-path: inset(-60px 0 -5px)
}
#loaderDownload:after {
  content: "";
  position: relative;
  background: repeating-linear-gradient(90deg,#0000 0 calc(50% - 8px), #313131 0 calc(50% + 8px), #0000 0 100%) 0 0/calc(100%/3) 100%;
  animation: l6-1 1s infinite;
} 
#loaderDownload:before {
  content: "";
  position: absolute;
  width: 14px;
  aspect-ratio: 1;
  left: calc(50% - 7px);
  bottom: 0;
  border-radius: 50%;
  background: #ED1C24;
  animation: l6-2 1s infinite;
}
@keyframes l6-1 {
  50%,100% {background-position: calc(100%/2) 0}
}
@keyframes l6-2 {
  0%,50% {transform:translateY(-80px)}
}
/* HTML: <div class="loaderEmit"></div> */
#loaderEmit {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
  border: 4px solid #0000;
  border-radius: 50%;
  border-right-color: #ED1C24;
  animation: l15 1s infinite linear;
}
#loaderEmit::before,
#loaderEmit::after {    
  content: "";
  grid-area: 1/1;
  margin: 2px;
  border: inherit;
  border-radius: 50%;
  animation: l15 2s infinite;
}
#loaderEmit::after {
  margin: 8px;
  animation-duration: 3s;
}
@keyframes l15{ 
  100%{transform: rotate(1turn)}
}
</style>

<body style="margin: 0; padding: 0;">
    <div class="container" id="containerFormRDEP">
        <br>
        <div class="row">
            <div class="col-md-12">
                <div class="card" style="margin-bottom: 20px; background-color: rgba(128, 128, 128, 0.069);">
                    <div class="card-header">Formulario ATS</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <img src="{% static 'logoishida.png' %}" alt="Logo" class="img-fluid"
                                    style="max-width: 150px; margin-bottom: 5px;">
                            </div>
                        </div>
                        <div class="row" id="rowButtons" style="display: none;">
                            <div class="col-md-6 d-flex justify-content-start align-items-center">
                                <button type="button" class="btn btn-danger btn-block" data-toggle="modal"
                                    data-target="#reportModal">Generar Reportes
                                </button>
                            </div>
                            <div class="col-md-6 text-center">
                                <button class="btn btn-dark btn-block" type="button" id="btnRedep">REDEP</button>
                            </div>
                        </div>
                        <hr>
                        <style>
                            .text-white-bold {
                                color: white !important;
                                font-weight: bold;
                            }
                        </style>
                        <div id="detailEmpleado">
                            <!-- Sección con botones de navegación -->
                            <div class="row justify-content-between">
                                <div class="col-md-3">
                                    <button id="btnBack" class="btn btn-dark btn-sm"
                                        style="margin-top: 15px; margin-bottom: 15px;">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"
                                            style="fill: white; width: 15px; height: 15px;">
                                            <path
                                                d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                                        </svg>
                                    </button>
                                </div>
                                <div class="col-md-3 text-right">
                                    <button id="btnNext" class="btn btn-dark btn-sm"
                                        style="margin-top: 15px; margin-bottom: 15px;">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"
                                            style="fill: white; width: 15px; height: 15px;">
                                            <path
                                                d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32h306.8L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <hr>
                            <!-- Secciones -->
                            <form id="atsForm" method="POST" action="{% url 'crearats' %}">
                                {% csrf_token %}
                                <div id="divIniciarSesion" class="row justify-content-center">
                                    <div class="col-md-6">
                                        <div class="card text-white bg-dark mb-3">
                                            <div class="card-header">Iniciar Sesión</div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="username">Ruc</label>
                                                    <input type="text" class="form-control" id="username"
                                                        name="username" placeholder="Ingrese el RUC" maxlength="13"
                                                        inputmode="numeric">
                                                    <div class="invalid-feedback">Por favor, ingrese un RUC válido de
                                                        Ecuador.
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="password">Ingrese la contraseña</label>
                                                    <div class="input-group" id="show_hide_password">
                                                        <input class="form-control" type="password" id="password"
                                                            name="password" placeholder="Ingrese la contraseña">
                                                        <div class="input-group-append">
                                                            <span class="input-group-text">
                                                                <a href="" id="togglePassword"><i
                                                                        class="fa fa-eye-slash"
                                                                        aria-hidden="true"></i></a>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <small class="form-text font-weight-bold">Usuario y Contraseña del
                                                    SRI</small>
                                                <p id="textError" style="display: none;">form-text font-weight-bold</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="divRoutes" style="display: none;">
                                    <div class="row justify-content-center">
                                        <div class="col-md-10">
                                            <div class="card text-white bg-dark mb-3">
                                                <div class="card-header">Seleccionar Ruta</div>
                                                <div class="card-body">
                                                    <div class="form-group">
                                                        <label for="directoryInput">Ingrese la ruta de la carpeta de
                                                            destino</label>
                                                        <input type="text" class="form-control" id="directoryInput"
                                                            name="directoryInput" placeholder="C:\ia\SRIBOT\XML">
                                                    </div>
                                                    <hr>
                                                    <p>Opciónes de limpieza</p>
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="input-group mb-3">
                                                                <select class="custom-select" id="selectOptionsClear">
                                                                    <option value="1" selected>No</option>
                                                                    <option value="2">Todas</option>
                                                                    <option value="3">Carpeta raiz</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <select class="form-control" id="selectYearClear"
                                                                name="selectYearClear">
                                                                {% for year in years %}
                                                                <option value="{{ year }}">{{ year }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="input-group mb-3">
                                                                <select class="custom-select" id="selectOptionMounth"
                                                                    disabled>
                                                                    <option value="1">Enero</option>
                                                                    <option value="2">Febrero</option>
                                                                    <option value="3">Marzo</option>
                                                                    <option value="4">Abril</option>
                                                                    <option value="5">Mayo</option>
                                                                    <option value="6">Junio</option>
                                                                    <option value="7">Julio</option>
                                                                    <option value="8">Agosto</option>
                                                                    <option value="9">Septiembre</option>
                                                                    <option value="10">Octubre</option>
                                                                    <option value="11">Noviembre</option>
                                                                    <option value="12">Diciembre</option>
                                                                    <option value="13">Todo el año</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="input-group mb-3">
                                                                <select class="custom-select" id="selectOptionEmiRec"
                                                                    disabled>
                                                                    <option value="" selected> </option>
                                                                    <option value="E">Emitidas</option>
                                                                    <option value="R">Recibidas</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <button class="btn btn-light" type="button"
                                                        id="btnClearFolders">Limpiar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="divRecibidos" style="display: none;">
                                    <div class="card">
                                        <div class="card-body">
                                            <h3>Comprobantes Electronicos Recibidos</h3>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <p><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"
                                                            style="width: 20px; height: 20px;">
                                                            <path
                                                                d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z" />
                                                        </svg><b> Recomendaciones:</b> Verificar la información de las carpetas
                                                        que son necesarias para la generación del ATS.
                                                        <br>
                                                        <i><b>Click en cada tipo de comprobante para la verificación.</b></i>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row g-1">
                                                        <div class="col-md-4">
                                                            <label for="dia">Seleccione el Año</label>
                                                            <select class="form-control" id="anio" name="anio">
                                                                {% for year in years %}
                                                                <option value="{{ year }}">{{ year }}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <br>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label for="mes">Seleccione el Mes</label>
                                                            <select class="form-control" id="mes" name="mes">
                                                                <option value="1">Enero</option>
                                                                <option value="2">Febrero</option>
                                                                <option value="3">Marzo</option>
                                                                <option value="4">Abril</option>
                                                                <option value="5">Mayo</option>
                                                                <option value="6">Junio</option>
                                                                <option value="7">Julio</option>
                                                                <option value="8">Agosto</option>
                                                                <option value="9">Septiembre</option>
                                                                <option value="10">Octubre</option>
                                                                <option value="11">Noviembre</option>
                                                                <option value="12">Diciembre</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label for="dia">Seleccione el Día</label>
                                                            <select class="form-control" id="dia" name="dia">
                                                                <option value="0">Todos</option>
                                                                {% for day in days %}
                                                                <option value="{{ day }}">{{ day }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <br>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row g-1">
                                                        <div class="col-md-12">
                                                            <label for="tipo_comprobante">Seleccione el Tipo de Comprobante</label>
                                                            <select class="form-control" id="tipo_comprobante" name="tipo_comprobante">
                                                                <option value="1">Facturas</option>
                                                                <option value="2">Liquidaciónes</option>
                                                                <option value="3">Nota de Crédito</option>
                                                                <option value="4">Nota de Débito</option>
                                                                <option value="6">Retención</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="rowDownloadCompRecib">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div id="contentLoader" class="loader-container" style="display: none;">
                                                        <div class="loader" id="loader"></div>
                                                        <div id="loaderDownload"></div>
                                                        <svg xmlns="http://www.w3.org/2000/svg" id="svgSuccess" style="width: 60px; height: auto;" viewBox="0 0 512 512"><path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"/></svg>
                                                        <h2 id="estadoPag"></h2>
                                                    </div>
                                                    <br>
                                                    <button type="button" id="btnDownload" class="btn btn-dark btn-block mt-3">
                                                        Descargar
                                                    </button>
                                                    <br>
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                                        style="width: 20px;height: 20px;">
                                                        <path
                                                            d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24l0 112c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-112c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z" />
                                                    </svg><b> Nota:</b>
                                                    <ol>
                                                        <li>Ejecutar el botón "Descargar".</li>
                                                        <li>Se abrirá automaticamente el portal del SRI y una ventana
                                                            solicitando el mes, día y tipo de comprobante.</li>
                                                        <li>
                                                            <i>La interacción del usuario termina en esta parte, se recomienda
                                                                dejar que el proceso concluya automaticamente</i>
                                                        </li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="divEmitidos" style="display: none;">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row g-1">
                                                <div class="col-md-12">
                                                    <h3>Comprobantes Electronicos Emitidos</h3>
                                                    <p>Este proceso es dependiente de los archivos que se encuentren descargados.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row g-1">
                                                        <div class="col-md-4">
                                                            <label for="dia">Seleccione el Año</label>
                                                            <select class="form-control" id="anioemitidos" name="anioemitidos">
                                                                {% for year in years %}
                                                                <option value="{{ year }}">{{ year }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label for="mes">Seleccione el Mes</label>
                                                            <select class="form-control" id="mesemitidos" name="mesemitidos">
                                                                <option value="1">Enero</option>
                                                                <option value="2">Febrero</option>
                                                                <option value="3">Marzo</option>
                                                                <option value="4">Abril</option>
                                                                <option value="5">Mayo</option>
                                                                <option value="6">Junio</option>
                                                                <option value="7">Julio</option>
                                                                <option value="8">Agosto</option>
                                                                <option value="9">Septiembre</option>
                                                                <option value="10">Octubre</option>
                                                                <option value="11">Noviembre</option>
                                                                <option value="12">Diciembre</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label for="dia">Seleccione el Día</label>
                                                            <select class="form-control" id="diaemitidos" name="diaemitidos">
                                                                <option value="0">Todos</option>
                                                                {% for day in days %}
                                                                <option value="{{ day }}">{{ day }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <br>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row g-1">
                                                        <div class="col-md-12">
                                                            <label for="tipo_comprobante_emitidos">Seleccione el Tipo de Comprobante</label>
                                                            <select class="form-control" id="tipo_comprobante_emitidos" name="tipo_comprobante_emitidos">
                                                                <option value="1">Facturas</option>
                                                                <option value="2">Liquidaciónes</option>
                                                                <option value="3">Nota de Crédito</option>
                                                                <option value="4">Nota de Débito</option>
                                                                <option value="6">Retención</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6" id="rowDownloadCompEmi">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-12 align-content-center ">
                                                            <div id="containerLoaderEmit" style="display: none;">
                                                                <div id="loaderEmit"></div>
                                                                <h2 id="estadoPagEmit"></h2>
                                                                <svg xmlns="http://www.w3.org/2000/svg" id="svgSuccessEmit" style="width: 60px; height: auto;" viewBox="0 0 512 512"><path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"/></svg>
                                                            </div>
                                                            <button type="button" id="btnEmitidos" class="btn btn-dark btn-block mt-3">
                                                                Descargar
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                                                style="width: 20px;height: 20px;">
                                                                <path
                                                                    d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24l0 112c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-112c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z" />
                                                            </svg> Nota:</span>
                                                            <ol>
                                                                <li>Ingresar al portal SRI.</li>
                                                                <li>Dirigirse al apartado de Facturación Electrónica / Producción /
                                                                    Consultas / Comprobantes Electrónicos Emitidos.</li>
                                                                <li>Selecciónar los días a descargar, el tipo de comprobante y
                                                                    consultar.</li>
                                                                <li>Descargar el archivo .txt y renombrarlo.</li>
                                                                <li>Mover el archivo descargado dependiendo el tipo de comprobante,
                                                                    ejemplo: (c:/ia/SRIBOT/XML/EMITIDAS).</li>
                                                                <li>Iniciar el BOT.</li>
                                                            </ol>
                                                            <i>Esto tiene un limite de 10 días permitidos para descargar el archivo.</i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="divAnulados" style="display: none;">
                                    <h3>Comprobantes Anulados</h3>
                                    <div class="row justify-content-center">
                                        <div class="col-md-12">
                                            <div class="card text-white bg-secondary mb-3">
                                                <div class="card-header">Formulario de Comprobantes Anulados</div>
                                                <div class="card-body">
                                                    <div class="form-group">
                                                        <label for="tipoComprobante">Tipo de Comprobante</label>
                                                        <select class="form-control" id="tipoComprobante"
                                                            name="tipoComprobante">
                                                            <option value="18">Factura</option>
                                                            <option value="07">Retención</option>
                                                            <option value="05">Nota de Débito</option>
                                                            <option value="04">Nota de Crédito</option>
                                                            <option value="03">Liquidación</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="autorizacion">Autorización</label>
                                                        <input type="text" class="form-control" id="autorizacion"
                                                            name="autorizacion" placeholder="Ingrese la autorización">
                                                    </div>
                                                    <button type="submit" class="btn btn-primary btn-block"
                                                        id="btnGuardarAnulado">Guardar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportModalLabel">Generar Reportes</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mt-3">
                        <div class="form-group col-md-6">
                            <label for="anioemitidos">Seleccione el Año</label>
                            <select class="form-control" id="aniomodal" name="aniomodal">
                                {% for year in years %}
                                <option value="{{ year }}">{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="mesemitidos">Seleccione el Mes</label>
                            <select class="form-control" id="mesmodal" name="mesmodal">
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4">
                            <button type="button" class="btn btn-danger btn-block"
                                id="openRecibidos">Recibidos</button>
                        </div>
                        <div class="col-4">
                            <button type="button" class="btn btn-danger btn-block" id="openEmitidos">Emitidos</button>
                        </div>
                        <div class="col-4">
                            <button type="button" class="btn btn-danger btn-block" id="btnCrearAts">Generar ATS</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script type="application/json" id="users-data">
    {{ users|json_script:"users-data" }}
</script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        var users = JSON.parse('{{ users|safe|escapejs }}');
        
        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('togglePassword');
        const usernameInput = document.getElementById('username');
        const btnRedep = document.getElementById('btnRedep');
        const rowDownloadCompRecib = document.getElementById('rowDownloadCompRecib');
        const rowDownloadCompEmi = document.getElementById('rowDownloadCompEmi');
        const directoryInput = document.getElementById('directoryInput');
        const textError = document.getElementById('textError');

        let valRutaFolder;


        // Funcionalidad de envio a la aplicacion para generar el XML
        btnRedep.addEventListener('click', function () {
            window.location.href = "{% url 'go_view_generatoXML' %}";
        })

        togglePassword.addEventListener('click', (e) => {
            e.preventDefault();
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.querySelector('i').classList.toggle('fa-eye');
            togglePassword.querySelector('i').classList.toggle('fa-eye-slash');
        });
        let found = false;
        passwordInput.addEventListener("input", function () {
            var passwordVal = passwordInput.value
            if (usernameInput.value != '' && passwordVal.length >= 4) {
                // Funcionalidad
                users.forEach(function(user){
                    if((usernameInput.value == user.ruc) && (passwordInput.value == user.password)){
                        found = true;
                        rowButtons.style.display = '';
                        textError.style.display = 'none';
                    }
                });
                if (!found) {
                    rowButtons.style.display = 'none';
                    textError.innerHTML = 'Error en el usuario o la contraseña.';
                    textError.style.color = 'red';
                    textError.style.display = '';
                }
            } else {
                rowButtons.style.display = 'none';
            }
        })

        usernameInput.addEventListener('input', function (e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 13);
            validateRuc();
        });

        function validateRuc() {
            const rucInput = document.getElementById('username');
            const ruc = rucInput.value;

            if (ruc.length === 13 && validarDocumento(ruc)) {
                rucInput.classList.remove('is-invalid');
                rucInput.classList.add('is-valid');
            } else {
                rucInput.classList.remove('is-valid');
                rucInput.classList.add('is-invalid');
            }
        }

        function validarDocumento(numero) {
            var suma = 0;
            var residuo = 0;
            var pri = false;
            var pub = false;
            var nat = false;
            var numeroProvincias = 24;
            var modulo = 11;

            /* Verifico que el campo no contenga letras */
            var ok = 1;
            for (i = 0; i < numero.length && ok == 1; i++) {
                var n = parseInt(numero.charAt(i));
                if (isNaN(n)) ok = 0;
            }
            if (ok == 0) {
                alert("No puede ingresar caracteres en el número");
                return false;
            }

            if (numero.length < 10) {
                alert('El número ingresado no es válido');
                return false;
            }

            /* Los primeros dos digitos corresponden al codigo de la provincia */
            var provincia = numero.substr(0, 2);
            if (provincia < 1 || provincia > numeroProvincias) {
                alert('El código de la provincia (dos primeros dígitos) es inválido');
                return false;
            }

            /* Aqui almacenamos los digitos de la cedula en variables. */
            var d1 = numero.substr(0, 1);
            var d2 = numero.substr(1, 1);
            var d3 = numero.substr(2, 1);
            var d4 = numero.substr(3, 1);
            var d5 = numero.substr(4, 1);
            var d6 = numero.substr(5, 1);
            var d7 = numero.substr(6, 1);
            var d8 = numero.substr(7, 1);
            var d9 = numero.substr(8, 1);
            var d10 = numero.substr(9, 1);

            /* El tercer digito es: */
            /* 9 para sociedades privadas y extranjeros   */
            /* 6 para sociedades publicas */
            /* menor que 6 (0,1,2,3,4,5) para personas naturales */

            if (d3 == 7 || d3 == 8) {
                alert('El tercer dígito ingresado es inválido');
                return false;
            }

            /* Solo para personas naturales (modulo 10) */
            if (d3 < 6) {
                nat = true;
                var p1 = d1 * 2;
                if (p1 >= 10) p1 -= 9;
                var p2 = d2 * 1;
                if (p2 >= 10) p2 -= 9;
                var p3 = d3 * 2;
                if (p3 >= 10) p3 -= 9;
                var p4 = d4 * 1;
                if (p4 >= 10) p4 -= 9;
                var p5 = d5 * 2;
                if (p5 >= 10) p5 -= 9;
                var p6 = d6 * 1;
                if (p6 >= 10) p6 -= 9;
                var p7 = d7 * 2;
                if (p7 >= 10) p7 -= 9;
                var p8 = d8 * 1;
                if (p8 >= 10) p8 -= 9;
                var p9 = d9 * 2;
                if (p9 >= 10) p9 -= 9;
                modulo = 10;
            }

            /* Solo para sociedades publicas (modulo 11) */
            /* Aqui el digito verficador esta en la posicion 9, en las otras 2 en la pos. 10 */
            else if (d3 == 6) {
                pub = true;
                p1 = d1 * 3;
                p2 = d2 * 2;
                p3 = d3 * 7;
                p4 = d4 * 6;
                p5 = d5 * 5;
                p6 = d6 * 4;
                p7 = d7 * 3;
                p8 = d8 * 2;
                p9 = 0;
            }

            /* Solo para entidades privadas (modulo 11) */
            else if (d3 == 9) {
                pri = true;
                p1 = d1 * 4;
                p2 = d2 * 3;
                p3 = d3 * 2;
                p4 = d4 * 7;
                p5 = d5 * 6;
                p6 = d6 * 5;
                p7 = d7 * 4;
                p8 = d8 * 3;
                p9 = d9 * 2;
            }

            suma = p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9;
            residuo = suma % modulo;

            /* Si residuo=0, dig.ver.=0, caso contrario 10 - residuo*/
            var digitoVerificador = residuo == 0 ? 0 : modulo - residuo;

            /* ahora comparamos el elemento de la posicion 10 con el dig. ver.*/
            if (pub == true) {
                if (digitoVerificador != d9) {
                    alert('El ruc de la empresa del sector público es incorrecto.');
                    return false;
                }
                /* El ruc de las empresas del sector publico terminan con 0001*/
                if (numero.substr(9, 4) != '0001') {
                    alert('El ruc de la empresa del sector público debe terminar con 0001');
                    return false;
                }
            } else if (pri == true) {
                if (digitoVerificador != d10) {
                    alert('El ruc de la empresa del sector privado es incorrecto.');
                    return false;
                }
                if (numero.substr(10, 3) != '001') {
                    alert('El ruc de la empresa del sector privado debe terminar con 001');
                    return false;
                }
            } else if (nat == true) {
                if (digitoVerificador != d10) {
                    alert('El número de cédula de la persona natural es incorrecto.');
                    return false;
                }
                if (numero.length > 10 && numero.substr(10, 3) != '001') {
                    alert('El ruc de la persona natural debe terminar con 001');
                    return false;
                }
            }
            return true;
        }

        const btnBack = document.getElementById('btnBack');
        const btnNext = document.getElementById('btnNext');
        const rowButtons = document.getElementById('rowButtons');
        const btnDownload = document.getElementById('btnDownload');
        const contentLoader = document.getElementById('contentLoader');
        const btnCrearAts = document.getElementById('btnCrearAts');
        const btnEmitidos = document.getElementById('btnEmitidos');
        const btnGuardarAnulado = document.getElementById('btnGuardarAnulado');
        const divIniciarSesion = document.getElementById('divIniciarSesion');
        const divRoutes = document.getElementById('divRoutes');
        const divRecibidos = document.getElementById('divRecibidos');
        const divEmitidos = document.getElementById('divEmitidos');
        const divAnulados = document.getElementById('divAnulados');
        const atsForm = document.getElementById('atsForm');

        let currentSection = 0;
        const sections = [divIniciarSesion, divRoutes, divRecibidos, divEmitidos, divAnulados];

        function showSection(index) {
            sections.forEach((section, i) => {
                section.style.display = i === index ? '' : 'none';
            });
        }

        btnBack.addEventListener('click', () => {
            if (currentSection > 0) {
                currentSection--;
                showSection(currentSection);
            }
        });

        btnNext.addEventListener('click', () => {
            if (currentSection == 1) {
                // Funcionalidad input Ruta
                if (directoryInput.value == '') {
                    valRutaFolder = 'C:\\IA\\SRIBOT';
                } else {
                    valRutaFolder = directoryInput.value;
                }
                // Aqui va la funcion que va a la vista valRutaFolder
            }
            if (currentSection < sections.length - 1) {
                currentSection++;
                showSection(currentSection);
            }
        });

        openRecibidos.addEventListener('click', () => {

            const aniomodal = document.getElementById('aniomodal').value;
            const mesSelect = document.getElementById('mesmodal');
            const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesmodal = mesSelect.options[mesSelect.selectedIndex].text;
            console.log('aniomodal', aniomodal)
            console.log(valRutaFolder)

            $('#reportModal').modal('hide');

            $.ajax({
                type: 'POST',
                url: atsForm.action,
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'action': 'ReporteRecibidos',
                    'directory': valRutaFolder,
                    'aniomodal': aniomodal,
                    'nombremesmodal': nombremesmodal

                },
                success: function (response) {
                    if (response.output) {
                        toastr.info(response.output, "Salida del Script");
                    } else {
                        toastr.success("Éxito");
                    }
                },
                error: function (response) {
                    toastr.error('No se seleccionó ningún archivo. Los datos no se han guardado.', "Error");
                }
            });
        });

        openEmitidos.addEventListener('click', () => {
            $('#reportModal').modal('hide');
            const aniomodal = document.getElementById('aniomodal').value;
            const mesSelect = document.getElementById('mesmodal');
            const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesmodal = mesSelect.options[mesSelect.selectedIndex].text;
            $.ajax({
                type: 'POST',
                url: atsForm.action,
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'action': 'ReporteEmitidos',
                    'directory': valRutaFolder,
                    'aniomodal': aniomodal,
                    'nombremesmodal': nombremesmodal
                },
                success: function (response) {
                    if (response.output) {
                        toastr.info(response.output, "Salida del Script");
                    } else {
                        toastr.success("Éxito");
                    }
                },
                error: function (response) {
                    toastr.error('No se seleccionó ningún archivo. Los datos no se han guardado.', "Error");
                }
            });
        });

        btnGuardarAnulado.addEventListener('click', (event) => {
            event.preventDefault();
            const formData = new FormData(atsForm);
            formData.append('action', 'guardar_anulados');

            fetch("{% url 'guardar_anulados' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
                .then(response => response.json())
                .then(data => {
                    toastr.success(data.output);
                    autorizacionInput.value = ''; // Limpiar el campo de autorización
                })
                .catch(error => {
                    toastr.error('Error al guardar el comprobante anulado.');
                });
        });

        btnDownload.addEventListener('click', () => {
            let arrayComprobantes = ['Facturas', 'Liquidaciones', 'NotasCredito', 'NotasDebito', 'Retenciones']
            checkXmlFiles(arrayComprobantes)
            btnDownload.innerHTML = 'Descargando ...'
            btnDownload.disabled = true;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const mesSelect = document.getElementById('mes');
            const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesrecibidos = mesSelect.options[mesSelect.selectedIndex].text;
            const anio = document.getElementById('anio').value
            const dia = document.getElementById('dia').value;
            const tipo_comprobante = document.getElementById('tipo_comprobante').value;


            if (!username || !password || !mes || !dia || !tipo_comprobante) {
                toastr.warning("Por favor, complete todos los campos.", "Advertencia");
            } else {
                $.ajax({
                    type: 'POST',
                    url: atsForm.action,
                    data: {
                        'username': username,
                        'password': password,
                        'anio': anio,
                        'mes': mes,
                        'nombremesrecibidos': nombremesrecibidos,
                        'dia': dia,
                        'tipo_comprobante': tipo_comprobante,
                        'directory': valRutaFolder,
                        'action': 'BOTATS',
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        toastr.success(response.message, "Éxito");
                        btnDownload.disabled = true;
                    },
                    error: function (response) {
                        contentLoader.style.display = 'none';
                        toastr.error('Error al iniciar el script.', "Error");
                    }
                });
            }
        });

        btnEmitidos.addEventListener('click', () => {
            btnEmitidos.disabled = true;
            let arrayComprobantes = ['FacturasE', 'LiquidacionesE', 'NotasCreditoE', 'NotasDebitoE', 'RetencionesE']
            checkXmlFilesEmitidos(arrayComprobantes)
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const mesSelect = document.getElementById('mesemitidos');
            const mesemitidos = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesemitidos = mesSelect.options[mesSelect.selectedIndex].text;
            const anioemitidos = document.getElementById('anioemitidos').value;
            const diaemitidos = document.getElementById('diaemitidos').value;
            const tipo_comprobante_emitidos = document.getElementById('tipo_comprobante_emitidos').value;

            if (!username || !password || !mesemitidos || !anioemitidos || !diaemitidos || !tipo_comprobante_emitidos ) {
                toastr.warning("Por favor, complete todos los campos.", "Advertencia");
            } else {
                $.ajax({
                    type: 'POST',
                    url: atsForm.action,
                    data: {
                        'username': username,
                        'password': password,
                        'anioemitidos': anioemitidos,
                        'mesemitidos': mesemitidos,
                        'nombremesemitidos': nombremesemitidos,
                        'diaemitidos': diaemitidos,
                        'directory': valRutaFolder,
                        'tipo_comprobante_emitidos': tipo_comprobante_emitidos,
                        'action': 'BOTEMITIDOS',
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        toastr.success(response.message, "Éxito");
                    },
                    error: function (response) {
                        toastr.error('Error al iniciar el script.', "Error");
                    }
                });
            }
        });

        btnCrearAts.addEventListener('click', () => {
    const aniomodal = document.getElementById('aniomodal').value;
    const mesSelect = document.getElementById('mesmodal');
    const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
    const nombremesmodal = mesSelect.options[mesSelect.selectedIndex].text;
    
    console.log('ats', aniomodal, nombremesmodal);

    if (!aniomodal || !mes) {
        toastr.warning("Por favor, complete todos los campos requeridos.", "Advertencia");
    } else {
        $.ajax({
            type: 'POST',
            url: atsForm.action,
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'action': 'CrearAts',
                'directory': valRutaFolder,
                'aniomodal': aniomodal,
                'nombremesmodal': nombremesmodal
            },
            success: function (response) {
                toastr.success(response.output, 'Exito');
            },
            error: function (response) {
                toastr.error('Error al iniciar el script.', "Error");
            }
        });
    }
});



        function checkXmlFiles(arrayComprobantes) {
            const mesSelect = document.getElementById('mes');
            const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesrecibidos = mesSelect.options[mesSelect.selectedIndex].text;
            const anio = document.getElementById('anio').value
            const jsonArrayComprobantes = JSON.stringify(arrayComprobantes);
            $.ajax({
                type: 'POST',
                url: '{% url "check_xml_files" %}',
                data: {
                    'arrayComprobantes': jsonArrayComprobantes,
                    'anio': anio,
                    'nombremesrecibidos': nombremesrecibidos,
                    'directorys': valRutaFolder,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        toastr.success(response.output, "Éxito");
                    } else {
                        const errorMessage = `No se encontró ningún XML, descargue los comprobantes y verifique de nuevo.`;
                        toastr.error(errorMessage, "Error");
                    }
                },
                error: function (response) {
                    toastr.error('Error al verificar los archivos XML.', "Error");
                }
            });
        }

        function checkXmlFilesEmitidos(arrayComprobantes) {
            const mesSelect = document.getElementById('mesemitidos');
            const mes = mesSelect.value;  // Esto obtiene el valor (número) del mes
            const nombremesemitidos = mesSelect.options[mesSelect.selectedIndex].text;
            const anioemitidos = document.getElementById('anioemitidos').value
            const jsonArrayComprobantes = JSON.stringify(arrayComprobantes);
            $.ajax({
                type: 'POST',
                url: '{% url "check_xml_files_recibidos" %}',
                data: {
                    'arrayComprobantes': jsonArrayComprobantes,
                    'anioemitidos': anioemitidos,
                    'nombremesemitidos': nombremesemitidos,
                    'directorys': valRutaFolder,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'success') {
                        toastr.success(response.output, "Éxito");
                    } else {
                        const errorMessage = `No se encontró ningún XML, descargue los comprobantes y verifique de nuevo.`;
                        toastr.error(errorMessage, "Error");
                    }
                },
                error: function (response) {
                    toastr.error('Error al verificar los archivos XML.', "Error");
                }
            });
        }

        showSection(currentSection);


        // Opciones para la limpieza de carpetas
        const selectOptionsClear = document.getElementById('selectOptionsClear');
        const btnClearFolders = document.getElementById('btnClearFolders');
        const selectOptionMounth = document.getElementById('selectOptionMounth');
        const selectOptionEmiRec = document.getElementById('selectOptionEmiRec');
        const selectYearClear = document.getElementById('selectYearClear');

        // Funcionalidad de select
        selectOptionsClear.addEventListener('change', function () {
            if (selectOptionsClear.value == 1 || selectOptionsClear.value == 3) {
                selectOptionMounth.disabled = true;
                selectOptionEmiRec.disabled = true;
            } else {
                selectOptionMounth.disabled = false;
                selectOptionEmiRec.disabled = false;
            }
        })

        btnClearFolders.addEventListener('click', function () {
            var optionClear = selectOptionsClear.value == '' ? '1' : selectOptionsClear.value;
            valRutaFolder = valRutaFolder == undefined ? 'C:\\IA\\SRIBOT' : valRutaFolder;
            var yearClear = '\\' + selectYearClear.value;
            var optionMounth = '\\' + selectOptionMounth.options[selectOptionMounth.selectedIndex].text;
            var valEmiRec = '\\' + (selectOptionEmiRec.value == 'E' ? 'EMITIDAS' : 'RECIBIDAS');
            var fullDirectory = `${valRutaFolder}\\XML${yearClear}${optionMounth}${valEmiRec}`;
            var mainDirectory = `${valRutaFolder}\\XML`;

            switch (optionClear) {
                case "1":
                    break;
                case "2":
                    fetch('/delete_files/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: JSON.stringify({ ruta: fullDirectory })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                toastr.error('Error: ' + data.error + ', revisar la carpeta del mes', 'Error')
                            } else {
                                toastr.success(data.message, 'Exito en la limpieza')
                            }
                        });
                    break;
                case "3":
                    fetch('/delete_files/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: JSON.stringify({ ruta: mainDirectory })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                toastr.error('Error: ' + data.error + ', revisar la carpeta raíz.', 'Error')
                            } else {
                                toastr.success(data.message, 'Exito en la limpieza')
                            }
                        });
                    break;
            }
        });
        // Obtener el token CSRF para las solicitudes POST
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        // Funcion para ejecución de cada 3 segundos de consulta del estado
        const estadoPag = document.getElementById('estadoPag');
        const loader = document.getElementById('loader');
        const loaderDownload = document.getElementById('loaderDownload');
        const svgSuccess = document.getElementById('svgSuccess');
        const svgSuccessEmit = document.getElementById('svgSuccessEmit');
        const containerLoaderEmit = document.getElementById('containerLoaderEmit');
        const loaderEmit = document.getElementById('loaderEmit');
        const estadoPagEmit = document.getElementById('estadoPagEmit');

        function fetchEstado() {
            fetch('/get-estado/')
            .then(response => response.json())
            .then(data => {
                estadoPag.classList.remove('fade');
                void estadoPag.offsetWidth;
                estadoPag.classList.add('fade');
                estadoPag.innerText = data.estado;
                var estado = data.estado
                
                switch (estado) {
                    case "Sin ejecutar":
                        btnDownload.disabled = false;
                        contentLoader.style.display = "none";
                        loader.style.display = "none";
                        loaderDownload.style.display = "none";
                        svgSuccess.style.display = "none";
                        break
                    case "Esperando ejecución":
                        btnDownload.disabled = true;
                        contentLoader.style.display = "";
                        loader.style.display = "";
                        loaderDownload.style.display = "none";
                        svgSuccess.style.display = "none";
                        break;
                    case "Ingresando al portal SRI.":
                        btnDownload.disabled = true;
                        contentLoader.style.display = "";
                        loader.style.display = "";
                        loaderDownload.style.display = "none";
                        svgSuccess.style.display = "none";
                        break;
                    case "Descargando archivos ...":
                        btnDownload.disabled = true;
                        contentLoader.style.display = "";
                        loader.style.display = "none";
                        loaderDownload.style.display = "";
                        svgSuccess.style.display = "none";
                        break
                    case "Comprobantes descargados exitosamente.":
                        btnDownload.innerHTML = 'Descargar'
                        contentLoader.style.display = "";
                        btnDownload.disabled = false;
                        loader.style.display = "none";
                        loaderDownload.style.display = "none";
                        svgSuccess.style.display = "";
                        break;
                    case "Los comprobantes de esta fecha se encuentran actualizados":
                        btnDownload.innerHTML = 'Descargar'
                        contentLoader.style.display = "";
                        btnDownload.disabled = false;
                        loader.style.display = "none";
                        loaderDownload.style.display = "none";
                        svgSuccess.style.display = "";
                        break;
                }
            })
            .catch(error => console.error('Error:', error));
        }
        setInterval(fetchEstado, 1000);

        function fetchEstadoEmit() {
            fetch('/get-estadoEmit/')
            .then(response => response.json())
            .then(data => {
                estadoPagEmit.classList.remove('fade');
                void estadoPagEmit.offsetWidth;
                estadoPagEmit.classList.add('fade');
                estadoPagEmit.innerText = data.estado_emitido;
                var estados = data.estado_emitido
                
                switch (estados) {
                    case 'Esperando ejecución.':
                        containerLoaderEmit.style.display = "";
                        loaderEmit.style.display = "";
                        btnEmitidos.disabled = true;
                        svgSuccessEmit.style.display = "none";
                        break;
                    case 'Descarga completa.':
                    case 'No existe información del día consultado.':    
                        containerLoaderEmit.style.display = "";
                        loaderEmit.style.display = "none";
                        btnEmitidos.disabled = false;
                        svgSuccessEmit.style.display = "";
                        break;
                    case 'Sin ejecutar':
                        btnEmitidos.disabled = false;
                        loaderEmit.style.display = "none";
                        containerLoaderEmit.style.display = "none";
                        svgSuccessEmit.style.display = "none";
                        break;
                }
            })
            .catch(error => console.error('Error:', error));
        }
        setInterval(fetchEstadoEmit, 1000);


        
    });
</script>

</html>