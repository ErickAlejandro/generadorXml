<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Xml</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body style="margin: 0; padding: 0;">
    <div class="container">
        <br>
        <div class="row">
            <div class="col-md-6">
                <button type="button" id="btnGetForm" class="btn btn-dark btn-block">Llenar formulario</button>
            </div>
            <div class="col-md-6">
                <button type="button" id="btnGetFile" class="btn btn-success btn-block">Transformar archivo XML</button>
            </div>
        </div>
    </div>
    <div class="container" id="containerXML" style="display: none;">
        <br>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">Generar XML</div>
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <label for="inputAddFile">Agregar un nuevo archivo</label>
                                <input type="file" class="form-control-file" id="inputAddFile">
                            </div>
                            <button type="button" class="btn btn-info" id="btnGenerateXml">Generar Xml</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container" id="containerFormRDEP" style="display: none;">
        <br>
        <div class="row">
            <div class="col-md-12">
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-header">Formulario RDEP</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="input-group">
                                    <div class="custom-file">
                                      <input type="file" class="custom-file-input" id="inputGetExcel" aria-describedby="inputGroupFileAddon01">
                                      <label class="custom-file-label" for="inputGetExcel">Escoger archivo</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="divInfoExcel"  style="display: none;">
                            <br>
                            <hr>
                            <h3>Información del Empleador</h3>
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="inputIdEmpleadorRuc">Ruc</label>
                                    <input type="number" class="form-control form-control-sm" id="inputIdEmpleadorRuc">
                                </div>
                                <div class="col-md-4">
                                    <label for="inputRazonSocial">Razón Social</label>
                                    <input type="text" class="form-control form-control-sm" id="inputRazonSocial">
                                </div>
                                <div class="col-md-4">
                                    <label for="inputDireccion">Dirección</label>
                                    <input type="text" class="form-control form-control-sm" id="inputDireccion">
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="custom-select" id="inputSelectAnio">
                                        <option value="" selected>Escoger el año</option>
                                        <!-- Resto de años desde el 2006 hasta el 2024 -->
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="custom-select" id="selectTipoEmpleador">
                                        <option value="" selected>Tipo empleador</option>
                                        <option value="PRIVADO_MIXTO">Privado o Mixto</option>
                                        <option value="PUBLICO_IFIS">Público o IFIS</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="custom-select" id="selectSeguridadSocial">
                                        <option value="" selected>Ente de Seguridad Social </option>
                                        <option value="IESS">IESS</option>
                                        <option value="ISSFA/USSPOL">ISSFA/USSPOL</option>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                          <tr>
                                            <th scope="col">RUC</th>
                                            <th scope="col">Nombres completos</th>
                                            <th scope="col">Establecimiento</th>
                                            <th scope="col">Sueldo y Salarios</th>
                                            <th scope="col"> Base imponible</th>
                                            <th scope="col">IR Causado</th>
                                            <th scope="col">Valor Retenido</th>
                                          </tr>
                                        </thead>
                                        <tbody id="tbodyTableEmpleados">
                                            <!-- TABLA DE INFORMACION -->
                                        </tbody>
                                      </table>
                                </div>
                            </div>
                            <br>
                        </div>
                        <div id="detailEmpleado" style="display: none;">
                            <button class="btn btn-dark btn-sm" id="btnBack" style="margin-top: 15px; margin-bottom: 15px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="fill: white; width: 15px; height: 15px;"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></button><h2>Detalles de Empleado</h2>
                            <!-- Botones para las particiones -->
                            <div class="row g-1">
                                <div class="col-md-3">
                                    <button type="button" id="btnDatosTrabajador" class="btn btn-link">Datos del trabajador</button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" id="btnIngresos" class="btn btn-link">Ingresos</button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" id="btnGastosDeduccionesExo" class="btn btn-link">Gastos, deducciones y exoneraciones</button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" id="btnResumenImp" class="btn btn-link">Resumen Impositivo</button>
                                </div>
                            </div>
                            <hr>
                            <!-- Informacion de los trabajador -->
                             <div id="divInfoTrabajador">
                                <h3>INFORMACIÓN DEL TRABAJADOR</h3>
                                 <div class="row">
                                     <div class="col-md-6">
                                         <label>Beneficio provincia de Galápagos</label>
                                         <div class="form-check">
                                             <input class="form-check-input" type="radio" name="exampleRadios" id="radioNoBenGalpg" value="NO">
                                             <label class="form-check-label" for="radioNoBenGalpg">
                                               No
                                             </label>
                                           </div>
                                           <div class="form-check">
                                             <input class="form-check-input" type="radio" name="exampleRadios" id="radioSiBenGalpg" value="SI">
                                             <label class="form-check-label" for="radioSiBenGalpg">
                                               Si
                                             </label>
                                         </div>
                                     </div>
                                     <div class="col-md-6">
                                         <label>Trabajador con o a cargo de personas con enfermedades catastróficas, raras y/o huérfanas</label>
                                         <div class="form-check">
                                             <input class="form-check-input" type="radio" name="exampleRadiosEnfCatastro" id="radioNoEnfCatastro" value="NO">
                                             <label class="form-check-label" for="radioNoEnfCatastro">
                                               No
                                             </label>
                                           </div>
                                           <div class="form-check">
                                             <input class="form-check-input" type="radio" name="exampleRadiosEnfCatastro" id="radioSiEnfCatastro" value="SI">
                                             <label class="form-check-label" for="radioSiEnfCatastro">
                                               Si
                                             </label>
                                         </div>
                                     </div>
                                 </div>
                                 <div class="row">
                                     <div class="col-md-6">
                                         <label>Número de cargas familiares para rebaja de gastos personales</label>
                                         <select class="custom-select custom-select-sm" id="selectTrabCargFam">
                                             <option value="" selected>Escoger una opción</option>
                                             
                                         </select>
                                     </div>
                                     <div class="col-md-6">
                                         <label>Tipo de identificación del trabajador</label>
                                         <select class="custom-select custom-select-sm" id="selectTipoIdentEmpleado">
                                             <option value="" selected>Escoger una opción</option>
                                             <option value="C">CÉDULA</option>
                                             <option value="ITE">IDENTIFICACIÓN TRIBUTARIA DEL EXTERIOR</option>
                                             <option value="P">PASAPORTE</option>
                                         </select>
                                     </div>
                                 </div>
                                 <div class="row">
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputNumCedulaEmpleado">Número de Identificación del trabajador</label>
                                             <input type="text" class="form-control form-control-sm" id="inputNumCedulaEmpleado">
                                         </div>
                                     </div>
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputApellidoTrabajador">Apellidos del trabajador</label>
                                             <input type="text" class="form-control form-control-sm" id="inputApellidoTrabajador">
                                         </div>
                                     </div>
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputNombreTrabajador">Nombres del trabajador</label>
                                             <input type="text" class="form-control form-control-sm" id="inputNombreTrabajador">
                                         </div>
                                     </div>
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputCodEstablecimiento">Código del establecimiento</label>
                                             <input type="text" class="form-control form-control-sm" id="inputCodEstablecimiento">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="row">
                                     <div class="col-md-4">
                                         <label>Residencia del trabajador</label>
                                         <select class="custom-select custom-select-sm" id="selectResidenTrab">
                                             <option value="" selected>Escoger una opción</option>
                                             <option value="01">RESIDENTE LOCAL</option>
                                             <option value="02">RESIDENTE EN EL EXTERIOR</option>
                                         </select>
                                     </div>
                                     <div class="col-md-4">
                                         <label>País de residencia del trabajador</label>
                                         <select class="custom-select custom-select-sm" id="selectPaisResidenTrab">
                                             <option value="" selected>Escoger una opción</option>
                                             
                                         </select>
                                     </div>
                                     <div class="col-md-4">
                                         <label>Aplica convenio para evitar doble imposición</label>
                                         <select class="custom-select custom-select-sm" id="selectApConvEvitDobImposi">
                                             <option value="NA" selected> </option>
                                             <option value="CC">CON CONVENIO</option>
                                             <option value="SC">SIN CONVENIO</option>
                                         </select>
                                     </div>
                                 </div>
                                 <div class="row">
                                     <div class="col-md-3">
                                         <label>Condición del trabajador respecto a discapacidades</label>
                                         <select class="custom-select custom-select-sm" id="selectCondtrabRespDis">
                                             <option value="01" selected>NO APLICA</option>
                                             <option value="02">TRABAJADOR CON DISCAPACIDAD</option>
                                             <option value="03">TRABAJADOR QUE ACTÚA EN CALIDAD DE SUSTITUTO DE UNA PERSONA CON DISCAPACIDAD</option>
                                             <option value="04">TRABAJADOR TIENE CÓNYUGE, PAREJA, EN UN ÚNION DE HECHO O HIJO CON DISCAPACIDAD Y SE ENCUENTRA BAJO SU CUIDADO Y/O RESPONSABILIDAD</option>
                                         </select>
                                     </div>
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputProceDisc">Porcentaje de discapacidad</label>
                                             <input type="text" class="form-control form-control-sm" id="inputProceDisc">
                                         </div>
                                     </div>
                                     <div class="col-md-3">
                                         <label>Tipo de identificación de la persona con discapacidad a quien sustituye o representa</label>
                                         <select class="custom-select custom-select-sm" id="selectTipIdenPersDisSustRep">
                                             <option value="N" selected> </option>
                                             <option value="C">CÉDULA</option>
                                             <option value="ITE">IDENTIFICACIÓN TRIBUTARIA DEL EXTERIOR</option>
                                             <option value="P">PASAPORTE</option>
                                         </select>
                                     </div>
                                     <div class="col-md-3">
                                         <div class="form-group">
                                             <label for="inputNumIdentificacionPerDisSusRep">Número de Identificación de la persona con discapacidad a quien sustituye o representa</label>
                                             <input type="text" class="form-control form-control-sm" id="inputNumIdentificacionPerDisSusRep">
                                         </div>
                                     </div>
                                 </div>
                             </div>
                             <div id="divIngresos" style="display: none;">
                                <h3>INGRESOS</h3>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputSueldosSalarios">Sueldos y salarios</label>
                                            <input type="number" class="form-control form-control-sm" id="inputSueldosSalarios">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputSobreComiBonosOtrIng">Sobresueldos, comisiones, bonos y otros ingresos gravados</label>
                                            <input type="number" class="form-control form-control-sm" id="inputSobreComiBonosOtrIng">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputPartUtil">Participación utilidades</label>
                                            <input type="number" class="form-control form-control-sm" id="inputPartUtil">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputIngGravGenEmp">Ingresos gravados generados con otros empleadores</label>
                                            <input type="number" class="form-control form-control-sm" id="inputIngGravGenEmp">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputImpRentAsuEmp">Impuestos a la renta asumido por este empleador</label>
                                            <input type="number" class="form-control form-control-sm" id="inputImpRentAsuEmp">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputDeciTer">Décimo Tercer sueldo</label>
                                            <input type="number" class="form-control form-control-sm" id="inputDeciTer">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputDecCuaSue">Décimo cuarto sueldo</label>
                                            <input type="number" class="form-control form-control-sm" id="inputDecCuaSue">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputFondoRes">Fondo de reserva</label>
                                            <input type="number" class="form-control form-control-sm" id="inputFondoRes">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputComEcoSalDig">Compensación Económica Salario Digno</label>
                                            <input type="number" class="form-control form-control-sm" id="inputComEcoSalDig">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputOtrRelDepConsMatGravImpRen">Otros ingresos en relación de dependencia que no constituyen materia gravada de impuesto a la renta</label>
                                            <input type="number" class="form-control form-control-sm" id="inputOtrRelDepConsMatGravImpRen">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="ingGravEmp">Ingresos gravados con este empleador</label>
                                            <input type="number" class="form-control form-control-sm" id="ingGravEmp" readonly>
                                        </div>
                                    </div>
                                </div>
                             </div>
                             <div id="divGastos" style="display: none;">
                                <h3>GASTOS, DEDUCCIONES y EXONERACIONES</h3>
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>Sistema de salario neto</label>
                                        <select id="selectSisSalNet" class="custom-select custom-select-sm">
                                            <option value="" selected>Escoge alguna opcion</option>
                                            <option value="1">SIN SISTEMA DE SALARIO NETO</option>
                                            <option value="2">CON SISTEMA DE SALARIO NETO</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputApoPerIesEmp">Aporte personal IESS con este empleador (únicamente pagado por el trabajador)</label>
                                            <input type="number" class="form-control form-control-sm" id="inputApoPerIesEmp">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputApoPerIesOtrEmp">Aporte personal IESS con otros empleadores (únicamente pagado por el trabajador)</label>
                                            <input type="number" class="form-control form-control-sm" id="inputApoPerIesOtrEmp">
                                        </div>
                                    </div>
                                </div>
                                <h5>GASTOS PERSONALES</h5>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputVivienda">Vivienda</label>
                                            <input type="number" class="form-control form-control-sm" id="inputVivienda">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputSalud">Salud</label>
                                            <input type="number" class="form-control form-control-sm" id="inputSalud">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputEducacionArtCult">Educación Arte y Cultura</label>
                                            <input type="number" class="form-control form-control-sm" id="inputEducacionArtCult">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputAlimentacion">Alimentación</label>
                                            <input type="number" class="form-control form-control-sm" id="inputAlimentacion">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputVestimenta">Vestimenta</label>
                                            <input type="number" class="form-control form-control-sm" id="inputVestimenta">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputTurismo">Turismo</label>
                                            <input type="number" class="form-control form-control-sm" id="inputTurismo">
                                        </div>
                                    </div>
                                </div>
                                <h5>EXONERACIONES</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputDiscapacidad">Discapacidad</label>
                                            <input type="number" class="form-control form-control-sm" id="inputDiscapacidad">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputTerceraEdad">Tercera Edad</label>
                                            <input type="number" class="form-control form-control-sm" id="inputTerceraEdad">
                                        </div>
                                    </div>
                                </div>
                             </div>
                             <div id="divResumenImp" style="display: none;">
                                <h3>RESUMEN IMPOSITIVO</h3>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputBasImpGrav">Base Imponible gravada</label>
                                            <input type="number" class="form-control form-control-sm" id="inputBasImpGrav" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputImpRenCau">Impuesto a la renta causado</label>
                                            <input type="number" class="form-control form-control-sm" id="inputImpRenCau" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="inputValImpRetAsuOtrEmpPerDec">Valor del impuesto retenido y asumido por otros empleadores durante el periodo declarado</label>
                                            <input type="number" class="form-control form-control-sm" id="inputValImpRetAsuOtrEmpPerDec">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputValImpAsuEmp">Valor del impuesto asumido por este empleador</label>
                                            <input type="number" class="form-control form-control-sm" id="inputValImpAsuEmp">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputValImpRetTrabEmp">Valor del impuesto retenido al trabajador por este empleador</label>
                                            <input type="number" class="form-control form-control-sm" id="inputValImpRetTrabEmp">
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-dark" id="btnGenerateXSL" style="display: none;">Generar archivo XSL</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<!-- Script General -->
<script>
    const btnGetForm = document.getElementById("btnGetForm");
    const btnGetFile = document.getElementById("btnGetFile")
    const containerFormRDEP = document.getElementById("containerFormRDEP");
    const containerXML = document.getElementById("containerXML");

    const rowBtnSuccess = document.getElementById("rowBtnSuccess");
    
    const divInfoExcel = document.getElementById("divInfoExcel");
    const inputIdEmpleadorRuc = document.getElementById("inputIdEmpleadorRuc");
    const inputRazonSocial = document.getElementById("inputRazonSocial");
    const inputDireccion = document.getElementById("inputDireccion");

    const inputSelectAnio = document.getElementById("inputSelectAnio");
    const selectTipoEmpleador = document.getElementById("selectTipoEmpleador");
    const selectSeguridadSocial = document.getElementById("selectSeguridadSocial");
    const radioNoBenGalpg = document.getElementById("radioNoBenGalpg");
    const radioSiBenGalpg = document.getElementById("radioSiBenGalpg");
    const tbodyTableEmpleados = document.getElementById("tbodyTableEmpleados");
    const btnBack = document.getElementById("btnBack");
    const radioNoEnfCatastro = document.getElementById("radioNoEnfCatastro");
    const radioSiEnfCatastro = document.getElementById("radioSiEnfCatastro");

    const detailEmpleado = document.getElementById("detailEmpleado");

    const selectTrabCargFam = document.getElementById("selectTrabCargFam");
    const selectTipoIdentEmpleado = document.getElementById("selectTipoIdentEmpleado");
    const inputNumCedulaEmpleado = document.getElementById("inputNumCedulaEmpleado");
    const inputApellidoTrabajador = document.getElementById("inputApellidoTrabajador");
    const inputNombreTrabajador = document.getElementById("inputNombreTrabajador");
    const inputCodEstablecimiento = document.getElementById("inputCodEstablecimiento");
    const selectResidenTrab = document.getElementById("selectResidenTrab");
    const selectPaisResidenTrab = document.getElementById("selectPaisResidenTrab");
    const selectApConvEvitDobImposi = document.getElementById("selectApConvEvitDobImposi");
    const inputProceDisc = document.getElementById("inputProceDisc");
    const selectTipIdenPersDisSustRep = document.getElementById("selectTipIdenPersDisSustRep");
    const inputNumIdentificacionPerDisSusRep = document.getElementById("inputNumIdentificacionPerDisSusRep");
    const selectCondtrabRespDis = document.getElementById("selectCondtrabRespDis");

    const inputSueldosSalarios = document.getElementById("inputSueldosSalarios");
    const inputSobreComiBonosOtrIng = document.getElementById("inputSobreComiBonosOtrIng");
    const inputPartUtil = document.getElementById("inputPartUtil");
    const inputIngGravGenEmp = document.getElementById("inputIngGravGenEmp");
    const inputImpRentAsuEmp = document.getElementById("inputImpRentAsuEmp");
    const inputDeciTer = document.getElementById("inputDeciTer");
    const inputDecCuaSue = document.getElementById("inputDecCuaSue");
    const inputFondoRes = document.getElementById("inputFondoRes");
    const inputComEcoSalDig = document.getElementById("inputComEcoSalDig");
    const inputOtrRelDepConsMatGravImpRen = document.getElementById("inputOtrRelDepConsMatGravImpRen");
    const ingGravEmp = document.getElementById("ingGravEmp");

    const divInfoTrabajador = document.getElementById("divInfoTrabajador");
    const divIngresos = document.getElementById("divIngresos");
    const divGastos = document.getElementById("divGastos");
    const divResumenImp = document.getElementById("divResumenImp");

    const btnDatosTrabajador = document.getElementById("btnDatosTrabajador");
    const btnIngresos = document.getElementById("btnIngresos");
    const btnGastosDeduccionesExo = document.getElementById("btnGastosDeduccionesExo");
    const btnResumenImp = document.getElementById("btnResumenImp");

    const selectSisSalNet = document.getElementById("selectSisSalNet");
    const inputApoPerIesEmp = document.getElementById("inputApoPerIesEmp");
    const inputApoPerIesOtrEmp = document.getElementById("inputApoPerIesOtrEmp");
    const inputVivienda = document.getElementById("inputVivienda");
    const inputSalud = document.getElementById("inputSalud");
    const inputEducacionArtCult = document.getElementById("inputEducacionArtCult");
    const inputAlimentacion = document.getElementById("inputAlimentacion");
    const inputVestimenta = document.getElementById("inputVestimenta");
    const inputTurismo = document.getElementById("inputTurismo");
    const inputDiscapacidad = document.getElementById("inputDiscapacidad");
    const inputTerceraEdad = document.getElementById("inputTerceraEdad");

    const inputBasImpGrav = document.getElementById("inputBasImpGrav");
    const inputImpRenCau = document.getElementById("inputImpRenCau");
    const inputValImpRetAsuOtrEmpPerDec = document.getElementById("inputValImpRetAsuOtrEmpPerDec");
    const inputValImpAsuEmp = document.getElementById("inputValImpAsuEmp");
    const inputValImpRetTrabEmp = document.getElementById("inputValImpRetTrabEmp");

    const btnGenerateXSL = document.getElementById("btnGenerateXSL");

    btnGetForm.addEventListener("click", function(){
        containerFormRDEP.style.display = "";
        containerXML.style.display = "none";
    })

    btnGetFile.addEventListener("click", function(){
        containerFormRDEP.style.display = "none";
        containerXML.style.display = "";
    })

    btnBack.addEventListener("click", function(){
        detailEmpleado.style.display = "none";
        divInfoExcel.style.display = "";
    })

    // Funciona que carga el los selects
    for(i = 2006; i <= 2024; i++){
        const option = document.createElement("option");
        option.value = i;
        option.text = i;
        inputSelectAnio.appendChild(option)
    }
    // Funcionamiento desde 1 a 5 o más
    for(i = 0; i<= 5; i++){
        const option = document.createElement("option");
        if(i == 5){
            option.text = "5 o más";
            option.value = "5+";
        }else{
            option.value = i;
            option.text = i;
        }
        selectTrabCargFam.appendChild(option);
    }

    const paisesConCodigos = [
        { nombre: "Afganistán", codigo: "93" },
        { nombre: "Albania", codigo: "355" },
        { nombre: "Alemania", codigo: "49" },
        { nombre: "Andorra", codigo: "376" },
        { nombre: "Angola", codigo: "244" },
        { nombre: "Antigua y Barbuda", codigo: "1-268" },
        { nombre: "Arabia Saudita", codigo: "966" },
        { nombre: "Argelia", codigo: "213" },
        { nombre: "Argentina", codigo: "54" },
        { nombre: "Armenia", codigo: "374" },
        { nombre: "Australia", codigo: "61" },
        { nombre: "Austria", codigo: "43" },
        { nombre: "Azerbaiyán", codigo: "994" },
        { nombre: "Bahamas", codigo: "1-242" },
        { nombre: "Baréin", codigo: "973" },
        { nombre: "Bangladés", codigo: "880" },
        { nombre: "Barbados", codigo: "1-246" },
        { nombre: "Belice", codigo: "501" },
        { nombre: "Benín", codigo: "229" },
        { nombre: "Bielorrusia", codigo: "375" },
        { nombre: "Birmania", codigo: "95" },
        { nombre: "Bolivia", codigo: "591" },
        { nombre: "Bosnia y Herzegovina", codigo: "387" },
        { nombre: "Botsuana", codigo: "267" },
        { nombre: "Brasil", codigo: "55" },
        { nombre: "Brunéi", codigo: "673" },
        { nombre: "Bulgaria", codigo: "359" },
        { nombre: "Burkina Faso", codigo: "226" },
        { nombre: "Burundi", codigo: "257" },
        { nombre: "Bután", codigo: "975" },
        { nombre: "Cabo Verde", codigo: "238" },
        { nombre: "Camboya", codigo: "855" },
        { nombre: "Camerún", codigo: "237" },
        { nombre: "Canadá", codigo: "1" },
        { nombre: "Chad", codigo: "235" },
        { nombre: "Chile", codigo: "56" },
        { nombre: "China", codigo: "86" },
        { nombre: "Colombia", codigo: "57" },
        { nombre: "Comoras", codigo: "269" },
        { nombre: "Congo", codigo: "242" },
        { nombre: "Corea del Norte", codigo: "850" },
        { nombre: "Corea del Sur", codigo: "82" },
        { nombre: "Costa Rica", codigo: "506" },
        { nombre: "Croacia", codigo: "385" },
        { nombre: "Cuba", codigo: "53" },
        { nombre: "Chipre", codigo: "357" },
        { nombre: "Dinamarca", codigo: "45" },
        { nombre: "Dominica", codigo: "1-767" },
        { nombre: "República Dominicana", codigo: "1-809" },
        { nombre: "Ecuador", codigo: "593" },
        { nombre: "Egipto", codigo: "20" },
        { nombre: "El Salvador", codigo: "503" },
        { nombre: "Emiratos Árabes Unidos", codigo: "971" },
        { nombre: "Eritrea", codigo: "291" },
        { nombre: "Eslovaquia", codigo: "421" },
        { nombre: "Eslovenia", codigo: "386" },
        { nombre: "España", codigo: "34" },
        { nombre: "Estados Unidos", codigo: "1" },
        { nombre: "Estonia", codigo: "372" },
        { nombre: "Eswatini", codigo: "268" },
        { nombre: "Etiopía", codigo: "251" },
        { nombre: "Fiji", codigo: "679" },
        { nombre: "Filipinas", codigo: "63" },
        { nombre: "Finlandia", codigo: "358" },
        { nombre: "Francia", codigo: "33" },
        { nombre: "Gabón", codigo: "241" },
        { nombre: "Gambia", codigo: "220" },
        { nombre: "Georgia", codigo: "995" },
        { nombre: "Ghana", codigo: "233" },
        { nombre: "Granada", codigo: "1-473" },
        { nombre: "Grecia", codigo: "30" },
        { nombre: "Guatemala", codigo: "502" },
        { nombre: "Guinea", codigo: "224" },
        { nombre: "Guinea-Bisáu", codigo: "245" },
        { nombre: "Guyana", codigo: "592" },
        { nombre: "Haití", codigo: "509" },
        { nombre: "Holanda", codigo: "31" },
        { nombre: "Honduras", codigo: "504" },
        { nombre: "Hungría", codigo: "36" },
        { nombre: "India", codigo: "91" },
        { nombre: "Indonesia", codigo: "62" },
        { nombre: "Irán", codigo: "98" },
        { nombre: "Iraq", codigo: "964" },
        { nombre: "Irlanda", codigo: "353" },
        { nombre: "Islas Marshall", codigo: "692" },
        { nombre: "Islas Salomón", codigo: "677" },
        { nombre: "Islas Seychelles", codigo: "248" },
        { nombre: "Islas Vírgenes Británicas", codigo: "1-284" },
        { nombre: "Israel", codigo: "972" },
        { nombre: "Italia", codigo: "39" },
        { nombre: "Jamaica", codigo: "1-876" },
        { nombre: "Japón", codigo: "81" },
        { nombre: "Jordania", codigo: "962" },
        { nombre: "Kazajistán", codigo: "7" },
        { nombre: "Kenia", codigo: "254" },
        { nombre: "Kirguistán", codigo: "996" },
        { nombre: "Kiribati", codigo: "686" },
        { nombre: "Kuwait", codigo: "965" },
        { nombre: "Laos", codigo: "856" },
        { nombre: "Lesoto", codigo: "266" },
        { nombre: "Letonia", codigo: "371" },
        { nombre: "Líbano", codigo: "961" },
        { nombre: "Liberia", codigo: "231" },
        { nombre: "Libia", codigo: "218" },
        { nombre: "Liechtenstein", codigo: "423" },
        { nombre: "Lituania", codigo: "370" },
        { nombre: "Luxemburgo", codigo: "352" },
        { nombre: "Madagascar", codigo: "261" },
        { nombre: "Malasia", codigo: "60" },
        { nombre: "Malawi", codigo: "265" },
        { nombre: "Maldivas", codigo: "960" },
        { nombre: "Mali", codigo: "223" },
        { nombre: "Malta", codigo: "356" },
        { nombre: "Marruecos", codigo: "212" },
        { nombre: "Mauricio", codigo: "230" },
        { nombre: "Mauritania", codigo: "222" },
        { nombre: "México", codigo: "52" },
        { nombre: "Micronesia", codigo: "691" },
        { nombre: "Mónaco", codigo: "377" },
        { nombre: "Mongolia", codigo: "976" },
        { nombre: "Montenegro", codigo: "382" },
        { nombre: "Mozambique", codigo: "258" },
        { nombre: "Namibia", codigo: "264" },
        { nombre: "Nauru", codigo: "674" },
        { nombre: "Nepal", codigo: "977" },
        { nombre: "Nicaragua", codigo: "505" },
        { nombre: "Níger", codigo: "227" },
        { nombre: "Nigeria", codigo: "234" },
        { nombre: "Noruega", codigo: "47" },
        { nombre: "Nueva Zelanda", codigo: "64" },
        { nombre: "Omán", codigo: "968" },
        { nombre: "Países Bajos", codigo: "31" },
        { nombre: "Pakistán", codigo: "92" },
        { nombre: "Palau", codigo: "680" },
        { nombre: "Panamá", codigo: "507" },
        { nombre: "Papúa Nueva Guinea", codigo: "675" },
        { nombre: "Paraguay", codigo: "595" },
        { nombre: "Perú", codigo: "51" },
        { nombre: "Polonia", codigo: "48" },
        { nombre: "Portugal", codigo: "351" },
        { nombre: "Qatar", codigo: "974" },
        { nombre: "Reino Unido", codigo: "44" },
        { nombre: "República Centroafricana", codigo: "236" },
        { nombre: "República Checa", codigo: "420" },
        { nombre: "República del Congo", codigo: "242" },
        { nombre: "República Democrática del Congo", codigo: "243" },
        { nombre: "República Dominicana", codigo: "1-809" },
        { nombre: "Rumania", codigo: "40" },
        { nombre: "Rusia", codigo: "7" },
        { nombre: "Ruanda", codigo: "250" },
        { nombre: "San Cristóbal y Nieves", codigo: "1-869" },
        { nombre: "San Marino", codigo: "378" },
        { nombre: "Santa Lucía", codigo: "1-758" },
        { nombre: "Santa Elena", codigo: "290" },
        { nombre: "Santo Tomé y Príncipe", codigo: "239" },
        { nombre: "Senegal", codigo: "221" },
        { nombre: "Serbia", codigo: "381" },
        { nombre: "Seychelles", codigo: "248" },
        { nombre: "Sierra Leona", codigo: "232" },
        { nombre: "Singapur", codigo: "65" },
        { nombre: "Siria", codigo: "963" },
        { nombre: "Somalia", codigo: "252" },
        { nombre: "Sri Lanka", codigo: "94" },
        { nombre: "Suazilandia", codigo: "268" },
        { nombre: "Sudán", codigo: "249" },
        { nombre: "Sudán del Sur", codigo: "211" },
        { nombre: "Suecia", codigo: "46" },
        { nombre: "Suiza", codigo: "41" },
        { nombre: "Surinam", codigo: "597" },
        { nombre: "Tailandia", codigo: "66" },
        { nombre: "Timor Oriental", codigo: "670" },
        { nombre: "Togo", codigo: "228" },
        { nombre: "Tonga", codigo: "676" },
        { nombre: "Trinidad y Tobago", codigo: "1-868" },
        { nombre: "Túnez", codigo: "216" },
        { nombre: "Turkmenistán", codigo: "993" },
        { nombre: "Turquía", codigo: "90" },
        { nombre: "Tuvalu", codigo: "688" },
        { nombre: "Ucrania", codigo: "380" },
        { nombre: "Uganda", codigo: "256" },
        { nombre: "Uruguay", codigo: "598" },
        { nombre: "Uzbekistán", codigo: "998" },
        { nombre: "Vanuatu", codigo: "678" },
        { nombre: "Vaticano", codigo: "379" },
        { nombre: "Venezuela", codigo: "58" },
        { nombre: "Vietnam", codigo: "84" },
        { nombre: "Yemen", codigo: "967" },
        { nombre: "Zambia", codigo: "260" },
        { nombre: "Zimbabue", codigo: "263" }
    ];

    btnDatosTrabajador.addEventListener("click", function(){
        divInfoTrabajador.style.display = "";
        divIngresos.style.display = "none";
        divGastos.style.display = "none";
        divResumenImp.style.display = "none";
    });
    btnIngresos.addEventListener("click", function(){
        divIngresos.style.display = "";
        divInfoTrabajador.style.display = "none";
        divGastos.style.display = "none";
        divResumenImp.style.display = "none";
    });
    btnGastosDeduccionesExo.addEventListener("click", function(){
        divGastos.style.display = "";
        divIngresos.style.display = "none";
        divInfoTrabajador.style.display = "none";
        divResumenImp.style.display = "none";
    });
    btnResumenImp.addEventListener("click", function(){
        divResumenImp.style.display = "";
        divGastos.style.display = "none";
        divIngresos.style.display = "none";
        divInfoTrabajador.style.display = "none";
    })

    paisesConCodigos.forEach(pais =>{
        const option = document.createElement("option");
        option.value = pais.codigo;
        option.textContent = pais.nombre;
        selectPaisResidenTrab.appendChild(option)
    });

    function generateInfoEmpresa(array, arrayContent){
        if(array.length != 0 && arrayContent.length != 0){
            inputRazonSocial.disabled = false; 
            inputDireccion.disabled = false;
            divInfoExcel.style.display = "";
            
            // Carga de tablas
            Object.keys(arrayContent).forEach(key =>{
                if(arrayContent[key][8] == '' || (arrayContent[key][9] == undefined && arrayContent[key][10] == undefined )){
                    return;
                }
                const row = document.createElement("tr");
                const rucEmpleado = document.createElement("td");
                const nombreEmpleado = document.createElement("td");
                const establecimiento = document.createElement("td");
                const sueldoSalarios = document.createElement("td");
                const baseImponible = document.createElement("td");
                const IRCausado = document.createElement("td");
                const valRetenido = document.createElement("td");

                rucEmpleado.textContent = arrayContent[key][8];
                nombreEmpleado.textContent = `${arrayContent[key][9]} ${arrayContent[key][10]}`;
                establecimiento.textContent = arrayContent[key][11];
                var salario = parseFloat(arrayContent[key][19])
                sueldoSalarios.textContent = salario.toFixed(2);
                var baseImp = parseFloat(arrayContent[key][41]);
                baseImponible.textContent = baseImp.toFixed(2);
                IRCausado.textContent = arrayContent[key][42];
                valRetenido.textContent = arrayContent[key][47];

                // Funcionalidad y estilo de la fila
                row.style.cursor = "pointer";
                row.style.textAlign = "center";
                
                // Restricciones en caso de que alguna informacion de la empresa se encuentre vacio
                const empleado = arrayContent[key];
                for(let i = 0; i < empleado.length; i++){
                    switch (i) {
                        case 0:
                            if(empleado[i] == "" || empleado[i] == undefined){
                                const propField = prompt("No se ha encontrado el RUC de la empresa, por favor ingresar: ")
                                // Agregar la funcion para que en todo el arreglo se cambien los datos del ruc
                                arrayContent = changeFieldEmpleador(arrayContent, i, propField, (i+1))
                            }else{
                                break;
                            }
                        case 1:
                            if(empleado[i] == "" || empleado[i] == undefined){
                                const propField = prompt("No se ha encontrado el año, por favor ingresar: ")
                                // Agregar la funcion para que en todo el arreglo se cambien los datos del ruc
                                arrayContent = changeFieldEmpleador(arrayContent, i, propField, (i+1))
                            }else{
                                break;
                            }
                        case 2:
                            if(empleado[i] == "" || empleado[i] == undefined){
                                const propField = alertSelected('No se ha encontrado el tipo de Empleador:\n1. PRIVADO O MIXTO \n2. PÚBLICO O IFIS \n', ['PRIVADO_MIXTO', 'PUBLICO_IFIS']);
                                arrayContent = changeFieldEmpleador(arrayContent, i, propField, (i+1))
                            }else{
                                break;
                            }
                        case 3:
                            if(empleado[i] == "" || empleado[i] == undefined){
                                const propField = alertSelected('No se ha encontrado el tipo de ente de Seguro Social:\n1. IESS \n2. ISSFA/USSPOL \n', ['IESS', 'ISSFA_USSPOL']);
                                arrayContent = changeFieldEmpleador(arrayContent, i, propField, (i+1))
                            }else{
                                break;
                            }
                    }
                }
                // Condicion en caso de que el salario no corresponda con la base imponible
                var aporteIess = arrayContent[key][31];
                var porcentajeIess = parseFloat(arrayContent[key][19]) * 0.0945;
                if(aporteIess === porcentajeIess){
                    alert("El procentaje corresponde correctamente con el salario definido.")
                }else{
                    let messageContinueWithPorcenta = confirm(`En la fila ${key} el valor del porcentaje IESS no corresponde con el 9.45% del valor del salario ${salario}.Desea corregirlo ?`)
                    if(confirm){
                        alert("Se ha corregido los valores de Aporte a IESS.")
                        arrayContent[key][31] = porcentajeIess;
                        arrayContent[key][41] = arrayContent[key][19] + arrayContent[key][20] + arrayContent[key][21] + arrayContent[key][22] - (arrayContent[key][31])
                    }else{
                        alert("No se ha realizado ningun cambio, continuando operación ...")
                    }
                }
                var numRuc = empleado[0].replace(/\s+/g, '');
                // Agregar los nuevos campos
                inputIdEmpleadorRuc.value = numRuc == "" ? "" : numRuc;
                inputSelectAnio.value = empleado[1];
                selectTipoEmpleador.value = empleado[2];
                selectSeguridadSocial.value = empleado[3];
                
                // Funcionalidad de la fila
                row.addEventListener("click", function(){
                    const infoEmpleado = arrayContent[key];

                    detailEmpleado.style.display = "";
                    divInfoExcel.style.display = "none";
                    
                    // Llenar el formulario
                    if(infoEmpleado[4] == "NO"){
                        radioNoBenGalpg.checked = true
                        radioSiBenGalpg.checked = false
                    }else{
                        radioSiBenGalpg.checked = true
                        radioNoBenGalpg.checked = false
                    }
                    // Funcionalidad del check en caso de que su valor cambie
                    radioNoBenGalpg.addEventListener("change", function(){
                        if(this.checked){
                            arrayContent[key][4] = "NO"
                        }
                    })
                    radioSiBenGalpg.addEventListener("change", function(){
                        if(this.checked){
                            arrayContent[key][4] = "SI"
                        }
                    })
                    if(infoEmpleado[5] == "NO"){
                        radioNoEnfCatastro.checked = true;
                        radioSiEnfCatastro.checked = false;
                    }else{
                        radioSiEnfCatastro.checked = true;
                        radioNoEnfCatastro.checked = false;
                    }
                    radioNoEnfCatastro.addEventListener("change", function(){
                        if(this.checked){
                            arrayContent[key][5] = "NO"
                        }
                    })
                    radioSiEnfCatastro.addEventListener("change", function(){
                        if(this.checked){
                            arrayContent[key][5] = "SI"
                        }
                    })

                    selectTrabCargFam.value = "";
                    selectTrabCargFam.value = infoEmpleado[6];
                    selectTrabCargFam.addEventListener("change", function(){
                        arrayContent[key][6] = selectTrabCargFam.value
                    })

                    selectTipoIdentEmpleado.value = "";
                    selectTipoIdentEmpleado.value = infoEmpleado[7];
                    selectTipoIdentEmpleado.addEventListener("change", function(){
                        arrayContent[key][7] = selectTipoIdentEmpleado.value;
                    });

                    inputNumCedulaEmpleado.value = ""
                    inputNumCedulaEmpleado.value = infoEmpleado[8];
                    inputNumCedulaEmpleado.addEventListener("input", function(){
                        arrayContent[key][8] =  inputNumCedulaEmpleado.value;
                    })

                    inputApellidoTrabajador.value = "";
                    inputApellidoTrabajador.value = infoEmpleado[9];
                    inputApellidoTrabajador.addEventListener("input", function(){
                        arrayContent[key][9] = inputApellidoTrabajador.value;
                    })

                    inputNombreTrabajador.value = "";
                    inputNombreTrabajador.value = infoEmpleado[10];
                    inputNombreTrabajador.addEventListener("input", function(){
                        arrayContent[key][10] = inputNombreTrabajador.value;
                    })

                    inputCodEstablecimiento.value = "";
                    inputCodEstablecimiento.value = infoEmpleado[11];
                    inputCodEstablecimiento.addEventListener("input", function(){
                        arrayContent[key][11] = inputCodEstablecimiento.value;
                    })

                    selectResidenTrab.value = "";
                    selectResidenTrab.value = infoEmpleado[12];
                    selectResidenTrab.addEventListener("change", function(){
                        arrayContent[key][12] = selectResidenTrab.value;
                    })

                    selectPaisResidenTrab.value = "";
                    selectPaisResidenTrab.value = infoEmpleado[13];
                    selectPaisResidenTrab.addEventListener("change", function(){
                        arrayContent[key][13] = selectPaisResidenTrab.value;
                    })
                    
                    selectApConvEvitDobImposi.value = "";
                    selectApConvEvitDobImposi.value = infoEmpleado[14];
                    selectApConvEvitDobImposi.addEventListener("change", function(){
                        arrayContent[key][14] = selectApConvEvitDobImposi.value;
                    })

                    selectCondtrabRespDis.value = "";
                    selectCondtrabRespDis.value = infoEmpleado[15];
                    selectCondtrabRespDis.addEventListener("change", function(){
                        arrayContent[key][15] = selectCondtrabRespDis.value
                    })

                    inputProceDisc.value = "";
                    inputProceDisc.value = infoEmpleado[16];
                    inputProceDisc.addEventListener("input", function(){
                        arrayContent[key][16] = inputProceDisc.value
                    })
                    
                    selectTipIdenPersDisSustRep.value = "";
                    selectTipIdenPersDisSustRep.value = infoEmpleado[17];
                    selectTipIdenPersDisSustRep.addEventListener("change", function(){
                        arrayContent[key][17] = selectTipIdenPersDisSustRep.value;
                    })

                    // Variables para los calculos
                    var valSueldoSalarios, valSobreComiBonosOtrIng, valPartUtil, valImpRentAsuEmp, valIngGravGenEmp, totalVal, totalValResImp, valApoPerIessConEstEmp, ValApoPerIesOtrEmp

                    inputSueldosSalarios.value = "";
                    var salario = parseFloat(infoEmpleado[19]);
                    inputSueldosSalarios.value = salario.toFixed(2);
                    valSueldoSalarios = parseFloat(inputSueldosSalarios.value);

                    inputSobreComiBonosOtrIng.value = "";
                    inputSobreComiBonosOtrIng.value = infoEmpleado[20];
                    valSobreComiBonosOtrIng = parseFloat(inputSobreComiBonosOtrIng.value);

                    inputPartUtil.value = "";
                    inputPartUtil.value = infoEmpleado[21];
                    valPartUtil = parseFloat(inputPartUtil.value);

                    inputIngGravGenEmp.value = "";
                    inputIngGravGenEmp.value = infoEmpleado[22];
                    valIngGravGenEmp = parseFloat(inputIngGravGenEmp.value);

                    inputImpRentAsuEmp.value = "";
                    inputImpRentAsuEmp.value = infoEmpleado[23];
                    valImpRentAsuEmp = parseFloat(inputImpRentAsuEmp.value);

                    inputDeciTer.value = "";
                    var decimoTer = parseFloat(infoEmpleado[24]);
                    inputDeciTer.value = decimoTer.toFixed(2);
                    inputDeciTer.addEventListener("input", function(){
                        arrayContent[key][24] = inputDeciTer.value;
                    })

                    inputDecCuaSue.value = "";
                    var decimoCuar = parseFloat(infoEmpleado[25])
                    inputDecCuaSue.value = decimoCuar.toFixed(2);
                    inputDecCuaSue.addEventListener("input", function(){
                        arrayContent[key][25] = inputDecCuaSue.value
                    })

                    inputFondoRes.value = "";
                    var fondoRes = parseFloat(infoEmpleado[26]);
                    inputFondoRes.value = fondoRes.toFixed(2);
                    inputFondoRes.addEventListener("input", function(){
                        arrayContent[key][26] = inputFondoRes.value;
                    })

                    inputComEcoSalDig.value = "";
                    inputComEcoSalDig.value = infoEmpleado[27];
                    inputComEcoSalDig.addEventListener("input", function(){
                        arrayContent[key][27] = inputComEcoSalDig.value;
                    })

                    inputOtrRelDepConsMatGravImpRen.value = "";
                    inputOtrRelDepConsMatGravImpRen.value = infoEmpleado[28];
                    inputOtrRelDepConsMatGravImpRen.addEventListener("input", function(){
                        arrayContent[key][28] = inputOtrRelDepConsMatGravImpRen.value;
                    })

                    inputApoPerIesEmp.value = "";
                    var aportePerIessEmp = parseFloat(infoEmpleado[31])
                    inputApoPerIesEmp.value = aportePerIessEmp.toFixed(2);
                    valApoPerIessConEstEmp = inputApoPerIesEmp.value;

                    inputApoPerIesOtrEmp.value = "";
                    inputApoPerIesOtrEmp.value = infoEmpleado[32];
                    ValApoPerIesOtrEmp = inputApoPerIesOtrEmp.value;
                    
                    // Valor total para ing Grav Emp
                    totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                    totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp)

                    ingGravEmp.value = "";
                    ingGravEmp.value = totalVal;

                    // GASTOS, DEDUCCIONES Y EXONERACIONES
                    selectSisSalNet.value = "";
                    selectSisSalNet.value = infoEmpleado[30];
                    selectSisSalNet.addEventListener("change", function(){
                        arrayContent[key][30] = selectSisSalNet.value;
                    })

                    inputVivienda.value = "";
                    inputVivienda.value = infoEmpleado[33];
                    inputVivienda.addEventListener("input", function(){
                        arrayContent[key][33] = inputVivienda.value;
                    })

                    inputSalud.value = "";
                    inputSalud.value = infoEmpleado[34];
                    inputSalud.addEventListener("input", function(){
                        arrayContent[key][34] = inputSalud.value;
                    })

                    inputEducacionArtCult.value = "";
                    inputEducacionArtCult.value = infoEmpleado[35];
                    inputEducacionArtCult.addEventListener("input", function(){
                        arrayContent[key][35] = inputEducacionArtCult.value;
                    })

                    inputAlimentacion.value = "";
                    inputAlimentacion.value = infoEmpleado[36];
                    inputAlimentacion.addEventListener("input", function(){
                        arrayContent[key][36] = inputAlimentacion.value;
                    })

                    inputVestimenta.value = "";
                    inputVestimenta.value = infoEmpleado[37];
                    inputVestimenta.addEventListener("input", function(){
                        arrayContent[key][37] = inputVestimenta.value;
                    })

                    inputTurismo.value = "";
                    inputTurismo.value = infoEmpleado[38];
                    inputTurismo.addEventListener("input", function(){
                        arrayContent[key][38] = inputTurismo.value;
                    })

                    inputDiscapacidad.value = "";
                    inputDiscapacidad.value = infoEmpleado[39];
                    inputDiscapacidad.addEventListener("input", function(){
                        arrayContent[key][39] = inputDiscapacidad.value;
                    })

                    inputTerceraEdad.value = "";
                    inputTerceraEdad.value = infoEmpleado[40];
                    inputTerceraEdad.addEventListener("input", function(){
                        arrayContent[key][40] = inputTerceraEdad.value;
                    })

                    // Funcionalidad de los inputs para el calculo -----------------------------
                    inputSueldosSalarios.addEventListener("input", function(){
                        valSueldoSalarios = parseFloat(inputSueldosSalarios.value == "" ? 0 : inputSueldosSalarios.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        ingGravEmp.value = totalVal;
                        inputBasImpGrav.value = totalValResImp;
                        arrayContent[key][19] = inputSueldosSalarios.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    });
                    inputSobreComiBonosOtrIng.addEventListener("input", function(){
                        valSobreComiBonosOtrIng = parseFloat(inputSobreComiBonosOtrIng.value == "" ? 0 : inputSobreComiBonosOtrIng.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2)
                        ingGravEmp.value = totalVal;
                        inputBasImpGrav.value = totalValResImp;
                        arrayContent[key][20] =  inputSobreComiBonosOtrIng.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    });
                    inputPartUtil.addEventListener("input", function(){
                        valPartUtil = parseFloat(inputPartUtil.value == "" ? 0 : inputPartUtil.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        ingGravEmp.value = totalVal;
                        inputBasImpGrav.value = totalValResImp;
                        arrayContent[key][21] = inputPartUtil.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp;
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    });
                    inputIngGravGenEmp.addEventListener("input", function(){
                        valIngGravGenEmp = parseFloat(inputIngGravGenEmp.value == "" ? 0 : inputIngGravGenEmp.value);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        inputBasImpGrav.value = totalValResImp;
                        arrayContent[key][22] = inputIngGravGenEmp.value;
                        arrayContent[key][41] =  totalValResImp;
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    })
                    inputBasImpGrav.addEventListener("input", function(){
                        valIngGravGenEmp = parseFloat(inputBasImpGrav.value == "" ? 0 : inputBasImpGrav.value);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        inputBasImpGrav.value = totalValResImp;
                    });
                    inputImpRentAsuEmp.addEventListener("input", function(){
                        valImpRentAsuEmp = parseFloat(inputImpRentAsuEmp.value == "" ? 0 : inputImpRentAsuEmp.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        ingGravEmp.value = totalVal;
                        inputBasImpGrav.value = totalValResImp;
                        arrayContent[key][23] = inputImpRentAsuEmp.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp;
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    });
                    inputApoPerIesEmp.addEventListener("input", function(){
                        valApoPerIessConEstEmp = parseFloat(inputApoPerIesEmp.value == "" ? 0 : inputApoPerIesEmp.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (valApoPerIessConEstEmp + ValApoPerIesOtrEmp);
                        totalValResImp = totalValResImp.toFixed(2);
                        inputBasImpGrav.value = totalValResImp;
                        ingGravEmp.value = totalVal;
                        arrayContent[key][23] = inputImpRentAsuEmp.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp;
                        arrayContent[key][31] = inputApoPerIesEmp.value;
                    });
                    inputApoPerIesOtrEmp.addEventListener("input", function(){
                        ValApoPerIesOtrEmp = parseFloat(inputApoPerIesOtrEmp.value == "" ? 0 : inputApoPerIesOtrEmp.value);
                        totalVal = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valImpRentAsuEmp;
                        totalVal = totalVal.toFixed(2);
                        totalValResImp = valSueldoSalarios + valSobreComiBonosOtrIng + valPartUtil + valIngGravGenEmp + valImpRentAsuEmp - (parseFloat(valApoPerIessConEstEmp) + parseFloat(ValApoPerIesOtrEmp));
                        totalValResImp = totalValResImp.toFixed(2);
                        inputBasImpGrav.value = totalValResImp;
                        ingGravEmp.value = totalVal;
                        arrayContent[key][23] = inputImpRentAsuEmp.value;
                        arrayContent[key][29] = totalVal;
                        arrayContent[key][41] =  totalValResImp;
                        arrayContent[key][32] = inputApoPerIesOtrEmp.value;
                    })

                    // RESUMEN IMPONIBLE GRAVADA
                    inputBasImpGrav.value = "";
                    inputBasImpGrav.value = totalValResImp.toFixed(2);

                    inputImpRenCau.value = "";
                    inputImpRenCau.value = infoEmpleado[42];
                    inputImpRenCau.addEventListener("input", function(){
                        arrayContent[key][42] = inputImpRenCau.value;
                    })

                    inputValImpRetAsuOtrEmpPerDec.value = "";
                    inputValImpRetAsuOtrEmpPerDec.value = infoEmpleado[45];
                    inputValImpRetAsuOtrEmpPerDec.addEventListener("input", function(){
                        arrayContent[key][45] = inputValImpRetAsuOtrEmpPerDec.value;
                    })

                    inputValImpAsuEmp.value = "";
                    inputValImpAsuEmp.value = infoEmpleado[46];
                    inputValImpAsuEmp.addEventListener("input", function(){
                        arrayContent[key][46] = inputValImpAsuEmp.value;
                    })

                    inputValImpRetTrabEmp.value = "";
                    inputValImpRetTrabEmp.value = infoEmpleado[47];
                    inputValImpRetTrabEmp.addEventListener("input", function(){
                        arrayContent[key][47] = inputValImpRetTrabEmp.value;
                    })
                });

                row.appendChild(rucEmpleado);
                row.appendChild(nombreEmpleado);
                row.appendChild(establecimiento);
                row.appendChild(sueldoSalarios);
                row.appendChild(baseImponible);
                row.appendChild(IRCausado);
                row.appendChild(valRetenido);

                tbodyTableEmpleados.appendChild(row);
            });
            console.log(arrayContent)
            // Funcionalidad del boton para generar el XLS
            btnGenerateXSL.style.display = "";
            btnGenerateXSL.addEventListener("click", function(){
                var wb = XLSX.utils.book_new();
                wb.Props = {
                    Title: `Informe ${inputRazonSocial.value == "" ? "SN" : inputRazonSocial.value}`,
                    Subject: "Reporte Generado",
                    Author: `${inputRazonSocial.value == "" ? "SN" : inputRazonSocial.value}`,
                    CreatedDate: new Date()
                };
                var filteredArrayContent = {};
                for (var key in arrayContent) {
                    if (arrayContent.hasOwnProperty(key)) {
                        // Verificar si la fila contiene un campo vacío
                        var row = arrayContent[key];
                        var hasEmptyField = row.some(field => field === "" || field === null || field === undefined);
                        if (!hasEmptyField) {
                            filteredArrayContent[key] = row;
                        }
                    }
                }
                var ws_data = [array];
                for (var key in filteredArrayContent) {
                    if (filteredArrayContent.hasOwnProperty(key)) {
                        ws_data.push(filteredArrayContent[key]);
                    }
                }
                var ws = XLSX.utils.aoa_to_sheet(ws_data);
                XLSX.utils.book_append_sheet(wb, ws, "Reporte");
                XLSX.writeFile(wb, `${inputRazonSocial.value == "" ? "SN" : inputRazonSocial.value}.xlsx`);
            })
        }else{
            btnGenerateXSL.style.display = "none";
            alert("El archivo no contiene datos que se puedan utilizar")
        }
    }

    function changeFieldEmpleador(obj, position, newField, propierty){
        let array
        Object.keys(obj).forEach(prop =>{
            array = obj[prop]
            array[position] = newField
        })
        return(obj)
    }

    function alertSelected( info,arrayOptions){
        var userChoice = prompt(info);
        var result;
        switch(userChoice) {
                case '1':
                    result = arrayOptions[0];
                    break;
                case '2':
                    result = arrayOptions[1];
                    break;
            }
        return result;
    }

    function changeBaseImp(obj, valueBaseImp){
        console.log(obj, valueBaseImp)
    }
    
</script>

<!-- Script para el formulario de generacion del Excel para el cliente -->
<script>

</script>

<!-- Script para tomar un archivo excel -->
 <script>
    const inputGetExcel = document.getElementById("inputGetExcel");

    inputGetExcel.addEventListener("change", function(event){
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonSheet = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            // Obtener la primera fila
            const arrayCabecera = jsonSheet[0];

            const rowsObject = {};
            for (let rowIndex = 1; rowIndex < jsonSheet.length; rowIndex++) {
                const rowData = jsonSheet[rowIndex];
                const rowValues = rowData.map(value => value);
                rowsObject[rowIndex] = rowValues; // Usar rowIndex para las filas a partir de 1
            }
            
            generateInfoEmpresa(arrayCabecera, rowsObject)
        };
        reader.readAsArrayBuffer(file);
    });
 </script>

<!-- Script para el generador de XML -->
<script>
    const btnGenerateXml = document.getElementById('btnGenerateXml');
    const inputAddFile = document.getElementById('inputAddFile');

    btnGenerateXml.addEventListener('click', function () {
        if (inputAddFile.files.length > 0) {
            var file = inputAddFile.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var workbook = XLSX.read(e.target.result, { type: 'binary' });
                var sheetName = workbook.SheetNames[0];
                var sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                var xmlContent = generateXmlFromSheet(sheetData);
                downloadXmlFile(xmlContent);
            }
            reader.readAsBinaryString(file);
        }
    })

    function generateXmlFromSheet(sheetData) {
        var xml = '<?xml version="1.0" encoding="ISO-8859-1" standalone="yes"?>\n<rdep>\n';
        // Verificar si las etiquetas numRuc, anio, tipoEmpleador y enteSegSocial son iguales en todas las columnas
        var firstRow = sheetData[0];
        var commonAttributes = {
            numRuc: null,
            anio: null,
            tipoEmpleador: null,
            enteSegSocial: null
        };
        for (var key in commonAttributes) {
            if (firstRow.hasOwnProperty(key)) {
                var firstValue = firstRow[key].toString().trim();
                // Verificar si el valor de la etiqueta es el mismo en todas las columnas
                var isCommon = sheetData.every(function (rowData) {
                    return rowData[key].toString().trim() === firstValue;
                });
                if (isCommon) {
                    // Establecer el valor común en el objeto commonAttributes
                    commonAttributes[key] = firstValue;
                }
            }
        }
        // Si hay valores comunes, agregar las etiquetas entre <rdep> y <datRetRelDep>
        if (Object.values(commonAttributes).some(value => value !== null)) {
            xml += '    <numRuc>' + commonAttributes.numRuc + '</numRuc>\n';
            xml += '    <anio>' + commonAttributes.anio + '</anio>\n';
            xml += '    <tipoEmpleador>' + commonAttributes.tipoEmpleador + '</tipoEmpleador>\n';
            xml += '    <enteSegSocial>' + commonAttributes.enteSegSocial + '</enteSegSocial>\n';
            xml += '\n\n';
        }
        // Agregar la etiqueta <retRelDep> como contenedor para <datRetRelDep>
        xml += '<retRelDep>\n';
        // Iterar sobre cada fila de datos en la hoja de cálculo
        for (var i = 0; i < sheetData.length; i++) {
            var rowData = sheetData[i];
            // Agregar dos saltos de línea antes de la primera <datRetRelDep> (excepto para la primera fila)
            if (i !== 0) {
                xml += '\n\n';
            }
            // Agregar la etiqueta <datRetRelDep> para cada fila
            xml += '<datRetRelDep>\n';
            // Agregar la etiqueta <empleado> con 4 espacios de sangría
            xml += '    <empleado>\n';
            // Iterar sobre cada propiedad (columna) en la fila hasta llegar a <suelSal>
            for (var key in rowData) {
                if (rowData.hasOwnProperty(key)) {
                    var tagName = key.trim();
                    var tagValue = rowData[key].toString().trim();
                    // Omitir las etiquetas que están fuera de <empleado>
                    if (tagName === 'numRuc' || tagName === 'anio' || tagName === 'tipoEmpleador' || tagName === 'enteSegSocial') {
                        continue;
                    }
                    // Detener la iteración cuando llegamos a <suelSal>
                    if (tagName === 'suelSal') {
                        break;
                    }
                    // Generar etiquetas XML para cada propiedad dentro de <empleado>
                    if (tagName === 'estab') {
                        tagValue = padWithZeros(tagValue, 2);
                    }
                    if (tagName === 'residenciaTrab') {
                        tagValue = padWithZerosOne(tagValue, 2);
                    }
                    if (tagName === 'idRet') {
                        tagValue = padWithZerosOne(tagValue, 10);
                    }
                    if (tagName === 'tipoTrabajDiscap') {
                        tagValue = padWithZerosOne(tagValue, 2);
                    }
                    // Generar etiquetas XML para cada propiedad dentro de <empleado>
                    xml += '        <' + tagName + '>' + tagValue + '</' + tagName + '>\n';
                }
            }
            // Cerrar la etiqueta </empleado> antes de las etiquetas desde <suelSal> hasta <valRet>
            xml += '    </empleado>\n';
            // Iterar sobre cada propiedad (columna) en la fila desde <suelSal> hasta <valRet>
            var insideEmpleado = false;
            for (var key in rowData) {
                if (rowData.hasOwnProperty(key)) {
                    var tagName = key.trim();
                    var tagValue = rowData[key].toString().trim();
                    // Iniciar la inclusión de etiquetas cuando llegamos a <suelSal>
                    if (tagName === 'suelSal') {
                        insideEmpleado = true;
                    }
                    if (insideEmpleado) {
                        // Omitir las etiquetas que están dentro de <empleado>
                        if (tagName === 'benGalpg' || tagName === 'enfcatastro' || tagName === 'numCargRebGastPers' || tagName === 'tipIdRet' || tagName === 'idRet' || tagName === 'apellidoTrab' || tagName === 'nombreTrab' || tagName === 'estab' || tagName === 'residenciaTrab' || tagName === 'paisResidencia' || tagName === 'aplicaConvenio' || tagName === 'tipoTrabajDiscap' || tagName === 'porcentajeDiscap' || tagName === 'tipIdDiscap') {
                            continue;
                        }

                        // Generar etiquetas XML para cada propiedad fuera de <empleado>
                        xml += '    <' + tagName + '>' + addTwoDecimals(tagName, tagValue) + '</' + tagName + '>\n';

                        // Detener la iteración cuando llegamos a <valRet>
                        if (tagName === 'valRet') {
                            insideEmpleado = false;
                            break;
                        }
                    }
                }
            }

            // Cerrar las etiquetas </datRetRelDep> al final de la fila
            xml += '</datRetRelDep>\n';
        }

        // Cerrar la etiqueta </retRelDep> después de todas las filas
        xml += '</retRelDep>\n';

        xml += '</rdep>';
        return xml;

        // Función para agregar dos decimales en 0 si es necesario
        function addTwoDecimals(tagName, value) {
            var floatValue = parseFloat(value);

            // Verificar si la etiqueta es "sisSalNet"
            if (tagName === 'sisSalNet') {
                // No agregar ".00" a sisSalNet
                return value.toString();
            }

            // Agregar ".00" solo si el valor es 0 o no tiene decimales
            return floatValue.toFixed(2);
        }
    }

    function padWithZeros(value, length) {
        value = value.toString();
        while (value.length < length) {
            value = '00' + value;
        }
        return value;
    }

    function padWithZerosOne(value, length) {
        value = value.toString();
        while (value.length < length) {
            value = '0' + value;
        }
        return value;
    }

    function downloadXmlFile(xmlContent) {
        var blob = new Blob([xmlContent], { type: 'text/plain' });
        var a = document.createElement('a');
        a.href = window.URL.createObjectURL(blob);
        a.download = 'archivo.xml';

        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

</script>

</html>